# Test E2E: Cr√©ation d'une alerte (Happy Path)
# Description: Test complet du flow de cr√©ation d'alerte depuis la s√©lection de cat√©gorie jusqu'√† la confirmation

appId: com.joker95.japap
---
# ========================================
# PHASE 1: CONNEXION
# ========================================
- runScript: echo "üìù Test E2E: Cr√©ation d'alerte"
- runScript: echo "üîê Phase 1: Connexion"

- runFlow: login.yaml

- runScript: echo "‚úÖ Phase 1 termin√©e: Utilisateur connect√©"

# ========================================
# PHASE 2: NAVIGATION VERS CR√âATION
# ========================================
- runScript: echo "üó∫Ô∏è Phase 2: Navigation vers cr√©ation d'alerte"

# Aller sur l'onglet "Cr√©er"
- tapOn:
    id: "tab-create"
- waitForAnimationToEnd

# V√©rifier que le modal de s√©lection de cat√©gorie est visible
- assertVisible:
    text: "Que se passe-t-il"
    timeout: 5000

- assertVisible:
    id: "category-modal-title"

- runScript: echo "‚úÖ Phase 2 termin√©e: Modal de s√©lection visible"

# ========================================
# PHASE 3: S√âLECTION DE CAT√âGORIE
# ========================================
- runScript: echo "üìã Phase 3: S√©lection d'une cat√©gorie d'alerte"

# Attendre que les cat√©gories soient charg√©es
- waitForAnimationToEnd

# S√©lectionner la cat√©gorie "Accident grave circulation" (code: ACCG)
- tapOn:
    id: "category-card-ACCG"
- waitForAnimationToEnd

# V√©rifier que le formulaire de d√©tails s'affiche
- assertVisible:
    text: "Signalement"
    timeout: 3000

- assertVisible:
    id: "alert-description-input"

- runScript: echo "‚úÖ Phase 3 termin√©e: Cat√©gorie s√©lectionn√©e"

# ========================================
# PHASE 4: V√âRIFICATION LOCALISATION
# ========================================
- runScript: echo "üìç Phase 4: V√©rification de la localisation"

# Attendre que la localisation soit r√©cup√©r√©e
- waitForAnimationToEnd:
    timeout: ${LOCATION_TIMEOUT}

# V√©rifier que le texte de localisation est visible
- assertVisible:
    id: "alert-location-text"

# V√©rifier que la localisation n'est pas "Chargement..."
- assertNotVisible:
    text: "Chargement..."

- runScript: echo "‚úÖ Phase 4 termin√©e: Localisation r√©cup√©r√©e"

# ========================================
# PHASE 5: REMPLIR LE FORMULAIRE
# ========================================
- runScript: echo "‚úçÔ∏è Phase 5: Remplissage du formulaire"

# Remplir la description
- tapOn:
    id: "alert-description-input"
- inputText: "Test automatique Maestro - Accident grave sur l'autoroute A1 direction nord. Plusieurs v√©hicules impliqu√©s. Embouteillage important."

- runScript: echo "‚úÖ Phase 5 termin√©e: Formulaire rempli"

# ========================================
# PHASE 6: SOUMETTRE L'ALERTE
# ========================================
- runScript: echo "üì§ Phase 6: Soumission de l'alerte"

# Faire d√©filer vers le bas pour voir le bouton Envoyer
- scroll

# Appuyer sur le bouton "Envoyer"
- tapOn:
    id: "alert-submit-button"

# Attendre le traitement (cr√©ation + possiblement upload)
- waitForAnimationToEnd:
    timeout: ${NETWORK_TIMEOUT}

- runScript: echo "‚úÖ Phase 6 termin√©e: Alerte soumise"

# ========================================
# PHASE 7: V√âRIFICATION DU SUCC√àS
# ========================================
- runScript: echo "‚úÖ Phase 7: V√©rification de la cr√©ation"

# V√©rifier le toast de succ√®s
- assertVisible:
    text: "Alerte cr√©√©e avec succ√®s"
    timeout: 5000

# Attendre que le toast disparaisse et que la navigation se fasse
- waitForAnimationToEnd

# V√©rifier qu'on est revenu √† l'√©cran d'accueil ou alertes
- assertVisible:
    id: "tab-alerts"

- runScript: echo "‚úÖ Phase 7 termin√©e: Alerte cr√©√©e avec succ√®s!"

# ========================================
# PHASE 8: V√âRIFICATION DANS LA LISTE
# ========================================
- runScript: echo "üìã Phase 8: V√©rification de l'alerte dans la liste"

# Aller sur l'onglet Alertes
- tapOn:
    id: "tab-alerts"
- waitForAnimationToEnd

# V√©rifier que la nouvelle alerte appara√Æt
- assertVisible:
    text: "Test automatique Maestro"
    timeout: 5000

- runScript: echo "‚úÖ Phase 8 termin√©e: Alerte visible dans la liste"

# ========================================
# TEST TERMIN√â
# ========================================
- runScript: echo "üéâ Test E2E r√©ussi: Alerte cr√©√©e et visible!"
